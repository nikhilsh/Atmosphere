PI = Math.PI
class @DataStore
	constructor: (@offsetTop, @plotPoints)->
		@store = []
		@$canvas = $('<canvas>')
			.css
				position: 'absolute'
				top: 0
				left: 0
				width: '100%'
				height: '100%'
				opacity: .5
				marginTop: @offsetTop
	start: ()->
		$(window).on 'deviceorientation.DataStore', (event) =>
			@onDeviceOrientation event.originalEvent
	onDeviceOrientation: (event) ->
		@add event
	stop: ()->
		$(window).off '.DataStore'

	add: (event) ->
		@store.push 
			alpha:	event.alpha
			beta :	event.beta
			gamma:	event.gamma
			t:	event.t or +new Date()

	plot: ()->
		return unless @store.length
		$('body')
			.append(@$canvas)

		w = @$canvas.width()	
		h = @$canvas.height()
		@$canvas.attr 'width', w
		@$canvas.attr 'height', h
		minT = @store[0].t
		maxT = @store[@store.length-1].t
		minT = 1412683717689#@store[0].t
		maxT = 1412683724706#@store[@store.length-1].t
		ctx = @$canvas[0].getContext '2d'
		ctx.clearRect(0, 0, w, h)

		ctx.lineWidth = 2;
		colors = 
			alpha: 'red'
			beta: 'green'
			gamma: 'blue'
		
		for axis, color of colors
			ctx.beginPath();
			ctx.strokeStyle = color
			ctx.moveTo(0,0)
			for data in @store
				x = (data.t-minT) / (maxT-minT)*w
				y = h - (data[axis] + 180) / (360) * h
				ctx.lineTo x, y
				ctx.fillRect(x-2,y-2,4,4) if @plotPoints
			ctx.stroke();

	setFromJSON: ->
		@stop()
		@store = [{"alpha":0,"beta":0,"gamma":0,"t":1412683717689},{"alpha":82.49551452639608,"beta":15.01050610578557,"gamma":-47.76805279850232,"t":1412683717779},{"alpha":80.13478860893532,"beta":14.637495583763013,"gamma":-44.17222284362538,"t":1412683717781},{"alpha":78.08836820184439,"beta":15.242823304283702,"gamma":-40.96743567268331,"t":1412683717830},{"alpha":78.20550688837723,"beta":16.314243641131664,"gamma":-39.40144500008094,"t":1412683717880},{"alpha":80.5009915217555,"beta":17.906844480302393,"gamma":-39.79823304651555,"t":1412683717930},{"alpha":84.11231190485859,"beta":19.701686885737143,"gamma":-41.589045175906804,"t":1412683717980},{"alpha":87.76826988451477,"beta":20.97410318146536,"gamma":-43.57997859199864,"t":1412683718031},{"alpha":90.77713451225402,"beta":21.804441810236796,"gamma":-45.14382027068292,"t":1412683718082},{"alpha":93.25817176034863,"beta":22.18489080185146,"gamma":-47.36661605921518,"t":1412683718137},{"alpha":94.93281905468119,"beta":21.680885671577563,"gamma":-49.973040010312324,"t":1412683718182},{"alpha":95.58566558200242,"beta":20.571835943896172,"gamma":-52.7294707433004,"t":1412683718233},{"alpha":94.02592572838806,"beta":17.85638919638697,"gamma":-56.83622643853609,"t":1412683718313},{"alpha":91.73805862136578,"beta":16.68743384714624,"gamma":-57.28358284871129,"t":1412683718384},{"alpha":89.2585375898073,"beta":15.887447831425025,"gamma":-57.14088604021292,"t":1412683718423},{"alpha":86.20221652960255,"beta":15.236478635815606,"gamma":-55.75157436787707,"t":1412683718473},{"alpha":82.9650188575158,"beta":14.628805750181073,"gamma":-53.41392718854712,"t":1412683718523},{"alpha":80.32000680929052,"beta":14.594395691273355,"gamma":-50.52573759117452,"t":1412683718574},{"alpha":79.0088522973452,"beta":15.025726240253055,"gamma":-48.07929330607707,"t":1412683718624},{"alpha":78.78911191981439,"beta":15.815892061770517,"gamma":-45.90317049961995,"t":1412683718674},{"alpha":79.86933997615353,"beta":17.282146730408037,"gamma":-44.33411107738085,"t":1412683718726},{"alpha":82.04423534197475,"beta":19.340877803548594,"gamma":-44.13603988673584,"t":1412683718776},{"alpha":84.95204486662058,"beta":21.27297560291405,"gamma":-45.534763113701494,"t":1412683718826},{"alpha":87.97725516558441,"beta":22.313163468191142,"gamma":-47.541871107110566,"t":1412683718877},{"alpha":90.54450209444182,"beta":22.638551908129614,"gamma":-49.82705344828487,"t":1412683718927},{"alpha":92.15728226240947,"beta":22.140210724693063,"gamma":-52.12684628440285,"t":1412683718977},{"alpha":93.04155422874855,"beta":20.936451050136526,"gamma":-54.69429651840248,"t":1412683719028},{"alpha":93.13525152846887,"beta":19.375381126050954,"gamma":-57.32961337736802,"t":1412683719078},{"alpha":92.54538634484605,"beta":17.740054377274937,"gamma":-59.6771958332536,"t":1412683719128},{"alpha":91.61284338443375,"beta":16.324806949439534,"gamma":-61.35640328829177,"t":1412683719177},{"alpha":90.25338744608531,"beta":15.121574952655063,"gamma":-62.132946813713374,"t":1412683719227},{"alpha":88.46084650849727,"beta":14.139265696439061,"gamma":-62.08536517218827,"t":1412683719287},{"alpha":86.92283617448602,"beta":13.404487960732261,"gamma":-61.83670383540481,"t":1412683719338},{"alpha":85.73603299899122,"beta":12.729027158749883,"gamma":-61.72338616157344,"t":1412683719388},{"alpha":84.42493949702401,"beta":12.133198667440668,"gamma":-61.52965869679891,"t":1412683719438},{"alpha":83.1554771553946,"beta":11.556695766130332,"gamma":-61.408306471623135,"t":1412683719489},{"alpha":77.776880166435,"beta":10.186448670772355,"gamma":-59.67454093640905,"t":1412683719540},{"alpha":73.59983163064457,"beta":9.445303068663819,"gamma":-57.130388104732916,"t":1412683719590},{"alpha":70.3513325480464,"beta":8.911322405186178,"gamma":-54.542268138727565,"t":1412683719641},{"alpha":70.10663808227358,"beta":9.10479522110968,"gamma":-53.91596214000518,"t":1412683719691},{"alpha":72.44831275185344,"beta":10.113169959785903,"gamma":-55.202794795260814,"t":1412683719743},{"alpha":76.38298527724622,"beta":11.70995277077058,"gamma":-57.34034118900843,"t":1412683719791},{"alpha":81.2236758367206,"beta":13.381867603301277,"gamma":-59.23109369404203,"t":1412683719842},{"alpha":86.30987627394623,"beta":14.836487476206655,"gamma":-61.47848599751733,"t":1412683719892},{"alpha":90.46014847394844,"beta":15.878631567435137,"gamma":-63.880501636892404,"t":1412683719947},{"alpha":93.93156254785353,"beta":16.475246270747263,"gamma":-66.65167888400363,"t":1412683719998},{"alpha":96.58052842087848,"beta":16.771770482161582,"gamma":-69.05792467691309,"t":1412683720044},{"alpha":98.58400304542266,"beta":16.869940517048992,"gamma":-70.95598169404956,"t":1412683720094},{"alpha":100.16980374547663,"beta":16.754388375518214,"gamma":-72.56615423925807,"t":1412683720145},{"alpha":101.18629357971287,"beta":16.540375854484964,"gamma":-73.74663531752549,"t":1412683720196},{"alpha":101.64830068548065,"beta":16.26283548712402,"gamma":-74.62549012753263,"t":1412683720245},{"alpha":101.39764238700188,"beta":16.000037459145034,"gamma":-75.61505459722015,"t":1412683720323},{"alpha":99.83388315463567,"beta":15.993276744230348,"gamma":-75.28629432984945,"t":1412683720373},{"alpha":96.9246616069839,"beta":16.801793001115175,"gamma":-72.21730688802853,"t":1412683720423},{"alpha":93.85016066357925,"beta":18.026418510521076,"gamma":-67.38292417404806,"t":1412683720473},{"alpha":91.51344332095655,"beta":19.21608848515748,"gamma":-62.08906815091708,"t":1412683720524},{"alpha":90.12526329578864,"beta":20.533240861012583,"gamma":-56.08037365606258,"t":1412683720575},{"alpha":90.53711063129185,"beta":22.051624444941353,"gamma":-51.87676682407821,"t":1412683720636},{"alpha":95.44299184775099,"beta":24.62891229673951,"gamma":-50.716003233522756,"t":1412683720688},{"alpha":97.70438586301557,"beta":25.280003323828986,"gamma":-52.25531129506878,"t":1412683720736},{"alpha":99.19010740462262,"beta":25.697553068936898,"gamma":-53.53924611357514,"t":1412683720786},{"alpha":99.75000666763763,"beta":25.811595775716164,"gamma":-54.13526222297061,"t":1412683720836},{"alpha":99.33773042535796,"beta":25.637268539871624,"gamma":-54.046737091097526,"t":1412683720886},{"alpha":97.25752736233754,"beta":25.05816988455676,"gamma":-53.04608498220936,"t":1412683720936},{"alpha":86.45337714473253,"beta":21.511980095240336,"gamma":-47.78471461236775,"t":1412683720986},{"alpha":69.27595961919047,"beta":12.95840114388001,"gamma":-37.31330260411042,"t":1412683721037},{"alpha":59.728317977325545,"beta":7.053724950215058,"gamma":-31.642001022786094,"t":1412683721086},{"alpha":57.96309927787925,"beta":6.924804168534054,"gamma":-32.07007051833864,"t":1412683721137},{"alpha":57.36390569193738,"beta":7.244931240398947,"gamma":-32.54743444938146,"t":1412683721188},{"alpha":57.28678513816078,"beta":7.597323732719335,"gamma":-33.62233992860585,"t":1412683721238},{"alpha":57.25120034026431,"beta":7.890720007337733,"gamma":-34.34762061952451,"t":1412683721306},{"alpha":57.313488826986784,"beta":8.211308133453114,"gamma":-34.76324380135327,"t":1412683721356},{"alpha":57.42563470358372,"beta":8.450426705678975,"gamma":-35.11552537564051,"t":1412683721407},{"alpha":57.5556963505874,"beta":8.708420579419105,"gamma":-35.83461264753665,"t":1412683721458},{"alpha":57.62487382032183,"beta":9.160084645729816,"gamma":-38.33319396104035,"t":1412683721508},{"alpha":56.163215362317885,"beta":9.490743488067798,"gamma":-44.44510243043345,"t":1412683721558},{"alpha":51.94076651825272,"beta":9.376484764864575,"gamma":-54.78939187562218,"t":1412683721608},{"alpha":47.371209555926555,"beta":10.628489387676385,"gamma":-63.87065037683969,"t":1412683721659},{"alpha":45.60446982304665,"beta":12.046689706296048,"gamma":-67.87814985543473,"t":1412683721709},{"alpha":45.017783477357675,"beta":12.160986182902267,"gamma":-68.31340709830666,"t":1412683721759},{"alpha":45.18888819067051,"beta":11.934414016630866,"gamma":-67.74437404574915,"t":1412683721818},{"alpha":45.412566840520206,"beta":11.549435018723997,"gamma":-67.17480632604124,"t":1412683721862},{"alpha":45.5904353900321,"beta":11.036525891877641,"gamma":-66.13602736819345,"t":1412683721912},{"alpha":47.717073361428056,"beta":10.558490725074588,"gamma":-63.71083022261387,"t":1412683721962},{"alpha":52.76597955324569,"beta":10.19815941780628,"gamma":-58.14239721270127,"t":1412683722013},{"alpha":59.47709424708383,"beta":11.597335725747197,"gamma":-51.8798971078106,"t":1412683722063},{"alpha":64.70205134278594,"beta":13.677920100158087,"gamma":-48.58981237044731,"t":1412683722113},{"alpha":66.99265702911184,"beta":13.801769417527298,"gamma":-47.406378340796934,"t":1412683722164},{"alpha":67.166658699955,"beta":13.824983851814597,"gamma":-47.994468577246515,"t":1412683722215},{"alpha":64.69271318973533,"beta":15.138347308456616,"gamma":-48.6104239623631,"t":1412683722265},{"alpha":49.11751434990201,"beta":27.496145246888673,"gamma":-42.74036118894953,"t":1412683722321},{"alpha":40.17934713748421,"beta":32.04810732238368,"gamma":-36.961634321437316,"t":1412683722370},{"alpha":33.84960086424012,"beta":32.49971013175712,"gamma":-32.95721017325166,"t":1412683722421},{"alpha":39.192503729489125,"beta":28.668820934471224,"gamma":-36.30398782512712,"t":1412683722521},{"alpha":48.91076737984256,"beta":22.63536978258184,"gamma":-41.54905415236216,"t":1412683722572},{"alpha":59.81338447391144,"beta":16.05274371431968,"gamma":-49.2713121764261,"t":1412683722623},{"alpha":65.91954125041372,"beta":11.36848045632381,"gamma":-52.31880705046305,"t":1412683722673},{"alpha":67.59724626851882,"beta":8.593785545996111,"gamma":-51.10095770020962,"t":1412683722722},{"alpha":69.55353694321082,"beta":7.2656095705570545,"gamma":-53.37277961728108,"t":1412683722772},{"alpha":70.54086182378899,"beta":6.689884987596414,"gamma":-55.19872548911163,"t":1412683722822},{"alpha":70.91468769374823,"beta":7.254487943184764,"gamma":-55.97565378238638,"t":1412683722872},{"alpha":71.50175800862124,"beta":11.024690795523886,"gamma":-55.18663255975738,"t":1412683722936},{"alpha":72.87732272352547,"beta":18.667442922730363,"gamma":-54.501626626248814,"t":1412683722987},{"alpha":73.17149615489765,"beta":27.67227291166259,"gamma":-52.861618685364235,"t":1412683723036},{"alpha":72.45689958629929,"beta":34.6453797278396,"gamma":-51.4302012021663,"t":1412683723086},{"alpha":73.37577418176907,"beta":38.46013730258647,"gamma":-53.53465502164122,"t":1412683723136},{"alpha":74.56091161026369,"beta":39.90245276497001,"gamma":-55.86396983331414,"t":1412683723187},{"alpha":74.55791056806916,"beta":40.105517319122356,"gamma":-56.51371800680608,"t":1412683723237},{"alpha":75.01501214943934,"beta":39.57695639791616,"gamma":-57.12282824491454,"t":1412683723290},{"alpha":75.56420660767203,"beta":38.68062128423401,"gamma":-57.72551116563205,"t":1412683723340},{"alpha":75.76827441514718,"beta":37.647804009747894,"gamma":-57.94191572703534,"t":1412683723390},{"alpha":75.642037696843,"beta":36.66410501855132,"gamma":-57.94420990578675,"t":1412683723440},{"alpha":75.01263100596184,"beta":35.13531980336425,"gamma":-57.8577014857155,"t":1412683723490},{"alpha":73.32442641771375,"beta":31.98936948762444,"gamma":-57.928267951209655,"t":1412683723541},{"alpha":69.77122279419804,"beta":25.628969275762522,"gamma":-56.55430022545362,"t":1412683723591},{"alpha":66.51733088004292,"beta":18.26235504260194,"gamma":-55.312580757334885,"t":1412683723641},{"alpha":65.05281412343413,"beta":13.459156328474275,"gamma":-55.072956077530286,"t":1412683723691},{"alpha":64.41016348380991,"beta":11.315712952264422,"gamma":-54.60022973894981,"t":1412683723742},{"alpha":64.35264408404066,"beta":10.562841832712294,"gamma":-54.58978390251417,"t":1412683723799},{"alpha":64.2449476532399,"beta":10.44280156431155,"gamma":-54.80681052467421,"t":1412683723849},{"alpha":64.27458478065927,"beta":10.520024746229788,"gamma":-55.24328734259467,"t":1412683723903},{"alpha":64.41390846037959,"beta":10.521962954025367,"gamma":-55.90797305104742,"t":1412683723953},{"alpha":64.37254028049209,"beta":10.457334792794068,"gamma":-56.10893095797632,"t":1412683724007},{"alpha":64.17820127702124,"beta":10.408954102292865,"gamma":-55.729021964693764,"t":1412683724062},{"alpha":64.0009194314468,"beta":10.346850645685123,"gamma":-55.29320540147449,"t":1412683724103},{"alpha":63.95393995872389,"beta":10.243316624258314,"gamma":-55.10081627262768,"t":1412683724156},{"alpha":63.91036297686548,"beta":9.688505554090991,"gamma":-54.27812592768968,"t":1412683724204},{"alpha":63.35866725656531,"beta":8.457214533601094,"gamma":-52.6048561183666,"t":1412683724254},{"alpha":62.38196618401093,"beta":6.17990275656505,"gamma":-50.24688024098155,"t":1412683724304},{"alpha":61.82027713675838,"beta":3.623160692706577,"gamma":-47.78547755106782,"t":1412683724355},{"alpha":63.61051818741192,"beta":2.6897891909985012,"gamma":-46.98456477536268,"t":1412683724405},{"alpha":69.18964324739684,"beta":4.238885323516181,"gamma":-50.76939657101683,"t":1412683724456},{"alpha":78.39988027542151,"beta":9.031641398939627,"gamma":-55.94243831444909,"t":1412683724555},{"alpha":80.49284907688966,"beta":10.520405092498203,"gamma":-57.18811433097769,"t":1412683724606},{"alpha":81.69966805781056,"beta":11.357835260869404,"gamma":-57.97278125758267,"t":1412683724656},{"alpha":82.98203584383629,"beta":11.676126069685115,"gamma":-59.604517469677745,"t":1412683724706}]
		#@store = [{"alpha":74.55791056806916,"beta":40.105517319122356,"gamma":-56.51371800680608,"t":1412683723237},{"alpha":75.01501214943934,"beta":39.57695639791616,"gamma":-57.12282824491454,"t":1412683723290},{"alpha":75.56420660767203,"beta":38.68062128423401,"gamma":-57.72551116563205,"t":1412683723340},{"alpha":75.76827441514718,"beta":37.647804009747894,"gamma":-57.94191572703534,"t":1412683723390},{"alpha":75.642037696843,"beta":36.66410501855132,"gamma":-57.94420990578675,"t":1412683723440},{"alpha":75.01263100596184,"beta":35.13531980336425,"gamma":-57.8577014857155,"t":1412683723490},{"alpha":73.32442641771375,"beta":31.98936948762444,"gamma":-57.928267951209655,"t":1412683723541},{"alpha":69.77122279419804,"beta":25.628969275762522,"gamma":-56.55430022545362,"t":1412683723591},{"alpha":66.51733088004292,"beta":18.26235504260194,"gamma":-55.312580757334885,"t":1412683723641},{"alpha":65.05281412343413,"beta":13.459156328474275,"gamma":-55.072956077530286,"t":1412683723691},{"alpha":64.41016348380991,"beta":11.315712952264422,"gamma":-54.60022973894981,"t":1412683723742},{"alpha":64.35264408404066,"beta":10.562841832712294,"gamma":-54.58978390251417,"t":1412683723799},{"alpha":64.2449476532399,"beta":10.44280156431155,"gamma":-54.80681052467421,"t":1412683723849},{"alpha":64.27458478065927,"beta":10.520024746229788,"gamma":-55.24328734259467,"t":1412683723903},{"alpha":64.41390846037959,"beta":10.521962954025367,"gamma":-55.90797305104742,"t":1412683723953},{"alpha":64.37254028049209,"beta":10.457334792794068,"gamma":-56.10893095797632,"t":1412683724007},{"alpha":64.17820127702124,"beta":10.408954102292865,"gamma":-55.729021964693764,"t":1412683724062},{"alpha":64.0009194314468,"beta":10.346850645685123,"gamma":-55.29320540147449,"t":1412683724103},{"alpha":63.95393995872389,"beta":10.243316624258314,"gamma":-55.10081627262768,"t":1412683724156},{"alpha":63.91036297686548,"beta":9.688505554090991,"gamma":-54.27812592768968,"t":1412683724204},{"alpha":63.35866725656531,"beta":8.457214533601094,"gamma":-52.6048561183666,"t":1412683724254},{"alpha":62.38196618401093,"beta":6.17990275656505,"gamma":-50.24688024098155,"t":1412683724304},{"alpha":61.82027713675838,"beta":3.623160692706577,"gamma":-47.78547755106782,"t":1412683724355},{"alpha":63.61051818741192,"beta":2.6897891909985012,"gamma":-46.98456477536268,"t":1412683724405},{"alpha":69.18964324739684,"beta":4.238885323516181,"gamma":-50.76939657101683,"t":1412683724456},{"alpha":78.39988027542151,"beta":9.031641398939627,"gamma":-55.94243831444909,"t":1412683724555},{"alpha":80.49284907688966,"beta":10.520405092498203,"gamma":-57.18811433097769,"t":1412683724606},{"alpha":81.69966805781056,"beta":11.357835260869404,"gamma":-57.97278125758267,"t":1412683724656},{"alpha":82.98203584383629,"beta":11.676126069685115,"gamma":-59.604517469677745,"t":1412683724706}]
		for event, i in @store
			@store[i].beta = 0
			@store[i].gamma = 0
	
